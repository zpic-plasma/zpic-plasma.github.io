<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>External EM fields - zpic@edu</title>
<meta name="description" content="Setting external electro-magnetic fields for you simulation">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="zpic@edu">
<meta property="og:title" content="External EM fields">
<meta property="og:url" content="http://localhost:4000/documentation/python/emext">


  <meta property="og:description" content="Setting external electro-magnetic fields for you simulation">












<link rel="canonical" href="http://localhost:4000/documentation/python/emext">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->


<!-- for mathjax support -->
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
  </script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>




<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          zpic@edu
          <span class="site-subtitle">PIC codes for plasma physics education</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about">About ZPIC</a>
            </li><li class="masthead__menu-item">
              <a href="/start">Getting started</a>
            </li><li class="masthead__menu-item">
              <a href="/documentation">Documentation</a>
            </li><li class="masthead__menu-item">
              <a href="/examples">Examples</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000//" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/documentation" itemprop="item"><span itemprop="name">Documentation</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/python" itemprop="item"><span itemprop="name">Python</span></a>
          <meta itemprop="position" content="3" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">External EM fields</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <a href="/start"><span class="nav__sub-title">Getting started</span></a>
        

        
        <ul>
          
            <li><a href="/start/docker">Running a Docker image</a></li>
          
            <li><a href="/start/download">Download ZPIC</a></li>
          
            <li><a href="/start/compile">Compiling the code</a></li>
          
            <li><a href="/start/compile/macosx">- Mac OS X</a></li>
          
            <li><a href="/start/compile/linux">- Linux</a></li>
          
            <li><a href="/start/compile/win64">- Windows (WSL)</a></li>
          
            <li><a href="/start/compile/msys2">- Windows (MSYS2)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/documentation/python"><span class="nav__sub-title">Using ZPIC with Python</span></a>
        

        
        <ul>
          
            <li><a href="/documentation/python/start">Getting started with Python</a></li>
          
            <li><a href="/documentation/python/particles">Particle species</a></li>
          
            <li><a href="/documentation/python/data">Simulation data</a></li>
          
            <li><a href="/documentation/python/save">Saving output</a></li>
          
            <li><a href="/documentation/python/laser">Laser pulses</a></li>
          
            <li><a href="/documentation/python/movwindow">Moving simulation window</a></li>
          
            <li><a href="/documentation/python/smooth">Current smoothing</a></li>
          
            <li><a href="/documentation/python/eminit">Initial EM fields</a></li>
          
            <li><a href="/documentation/python/emext" class="active">External EM fields</a></li>
          
            <li><a href="/documentation/python/spectralsolver">Spectral EM field solver</a></li>
          
            <li><a href="/documentation/python/api">Python API reference</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/documentation/c"><span class="nav__sub-title">Using ZPIC with C</span></a>
        

        
        <ul>
          
            <li><a href="/documentation/c/start">Getting started with C</a></li>
          
            <li><a href="/documentation/c/particles">Particle species</a></li>
          
            <li><a href="/documentation/c/diag">Simulation diagnostics</a></li>
          
            <li><a href="/documentation/c/laser">Laser pulses</a></li>
          
            <li><a href="/documentation/c/movwindow">Moving simulation window</a></li>
          
            <li><a href="/documentation/c/smooth">Current smoothing</a></li>
          
            <li><a href="/documentation/c/api">C API reference</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/examples"><span class="nav__sub-title">Examples</span></a>
        

        
        <ul>
          
            <li><a href="/examples/#tutorials">Tutorial</a></li>
          
            <li><a href="/examples/#classroom-examples">Classroom examples</a></li>
          
            <li><a href="/examples/#landmark-papers">Landmark papers</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="External EM fields">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">External EM fields
</h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> External EM fields</h4></header>
              <ul class="toc__menu"><li><a href="#introduction">Introduction</a></li><li><a href="#setting-the-external-em-fields">Setting the external EM fields</a></li><li><a href="#setting-custom-external-em-fields">Setting “custom” external EM fields</a></li><li><a href="#self-consistent-em-fields-and-total-em-fields">Self-consistent EM fields and total EM fields</a></li></ul>

            </nav>
          </aside>
        
        <h2 id="introduction">Introduction</h2>

<p>The ZPIC <code class="language-plaintext highlighter-rouge">em1d</code> and <code class="language-plaintext highlighter-rouge">em2d</code> codes allow the user to specify external EM fields to be used in the simulations. These fields, that are constant, will be superimposed on the self-consistent simulation EM fields and used for particle advance only; they do not contribute directly to the evolution of the simulation fields.</p>

<p>Please note that the usual field diagnostics will only report on the self consistent fields. If you want to the look at the full (self consistent + external) fields use the <code class="language-plaintext highlighter-rouge">sim.emf.*_part</code> properties, e.g. <code class="language-plaintext highlighter-rouge">sim.emf.Bz_part</code>. See below for more details.</p>

<h2 id="setting-the-external-em-fields">Setting the external EM fields</h2>

<p>Adding an external field is done using <code class="language-plaintext highlighter-rouge">ExternalField</code> objects and the <code class="language-plaintext highlighter-rouge">emf.set_ext_fld()</code> method as exemplified below. The following types of external fields are supported:</p>

<ul>
  <li>“<strong>none</strong>” - no external field</li>
  <li>“<strong>uniform</strong>” - spatially uniform field</li>
  <li>“<strong>custom</strong>” - field defined by a custom function</li>
</ul>

<p>The external electric and magnetic fields can be set separately.</p>

<p>The <code class="language-plaintext highlighter-rouge">ExternalField</code> class constructor uses the following parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">E_type</code> / <code class="language-plaintext highlighter-rouge">B_type</code> - Type of initial electric / magnetic field, must be one of:
    <ul>
      <li>“none” (default) - No initial field</li>
      <li>“uniform” - Uniform initial field</li>
      <li>“custom” - Custrom initial field</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">E_0</code> / <code class="language-plaintext highlighter-rouge">B_0</code> - Value of the initial electric / magnetic field when using the “uniform” type</li>
  <li><code class="language-plaintext highlighter-rouge">E_custom</code> / <code class="language-plaintext highlighter-rouge">B_custom</code> - Function defining the initial electric / magnetic field when using the “custom” type</li>
</ul>

<p>The following example sets an external uniform magnetic field $B_z = 1$ (in simulation units):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sim</span> <span class="o">=</span> <span class="n">em1d</span><span class="p">.</span><span class="n">Simulation</span><span class="p">(</span> <span class="p">...</span> <span class="p">)</span>
<span class="n">ext</span> <span class="o">=</span> <span class="n">em1d</span><span class="p">.</span><span class="n">ExternalField</span><span class="p">(</span><span class="n">B_type</span> <span class="o">=</span> <span class="s">'uniform'</span><span class="p">,</span> <span class="n">B_0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
<span class="n">sim</span><span class="p">.</span><span class="n">emf</span><span class="p">.</span><span class="n">set_ext_fld</span><span class="p">(</span> <span class="n">init</span> <span class="p">)</span>
</code></pre></div></div>

<h2 id="setting-custom-external-em-fields">Setting “custom” external EM fields</h2>

<p>The “custom” functions defining initial fields must take exactly 2 arguments in 1D. These arguments are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ix</code> - the cell index for which the field is being calculated</li>
  <li><code class="language-plaintext highlighter-rouge">dx</code> - the cell size in simulation units</li>
</ul>

<p>This function must return a 3 value list of all the field components. Also note that the position of all field components is not the same inside the cell, and that should be taken into account when calculating the field values.</p>

<p>The following example creates an external sinusoidal field $B_z = \sin(x)^2$:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">sin2</span><span class="p">(</span> <span class="n">ix</span><span class="p">,</span> <span class="n">dx</span> <span class="p">):</span>
    <span class="c1"># Bz is located at the center of the cell
</span>    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">ix</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>

<span class="n">ext</span> <span class="o">=</span> <span class="n">em1d</span><span class="p">.</span><span class="n">ExternalField</span><span class="p">(</span><span class="n">B_type</span> <span class="o">=</span> <span class="s">'custom'</span><span class="p">,</span> <span class="n">B_custom</span> <span class="o">=</span> <span class="n">sin2</span> <span class="p">)</span>
</code></pre></div></div>

<p>In 2D the function takes exactly 4 arguments:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ix</code> - the x cell index for which the field is being calculated</li>
  <li><code class="language-plaintext highlighter-rouge">dx</code> - the x cell size in simulation units</li>
  <li><code class="language-plaintext highlighter-rouge">iy</code> - the y cell index for which the field is being calculated</li>
  <li><code class="language-plaintext highlighter-rouge">dy</code> - the y cell size in simulation units</li>
</ul>

<p>Just like in 1D, this function must return a 3 value list of all the field components, and the position of field components inside the cell should be taken into account when calculating the field values.</p>

<p>The following example creates a circular magnetic field around the center of the box, falling off with $r^2$:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">extB</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">iy</span><span class="p">,</span><span class="n">dy</span><span class="p">):</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="mf">6.4</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="mf">6.4</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">ix</span><span class="o">*</span><span class="n">dx</span>       <span class="o">-</span> <span class="n">x0</span><span class="p">;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">iy</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">dy</span> <span class="o">-</span> <span class="n">y0</span><span class="p">;</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">;</span>
    <span class="n">bx</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span><span class="o">/</span><span class="n">r2</span><span class="p">;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">ix</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span> <span class="o">-</span> <span class="n">x0</span><span class="p">;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">iy</span><span class="o">*</span><span class="n">dy</span>       <span class="o">-</span> <span class="n">y0</span><span class="p">;</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">;</span>
    <span class="n">by</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">r2</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> 

<span class="n">init</span> <span class="o">=</span> <span class="n">em2d</span><span class="p">.</span><span class="n">ExternalField</span><span class="p">(</span><span class="n">B_type</span> <span class="o">=</span> <span class="s">'custom'</span><span class="p">,</span> <span class="n">B_custom</span> <span class="o">=</span> <span class="n">initB</span> <span class="p">)</span>
</code></pre></div></div>

<h2 id="self-consistent-em-fields-and-total-em-fields">Self-consistent EM fields and total EM fields</h2>

<p>As mentioned above, the external fields are super-imposed (added) to the simulation self-consistent fields at particle push time, directly affecting particle motion. The field advance does not use the external fields, and the self-consistent fields are kept separately.</p>

<p>To simplify diagnostics, ZPIC allows access to both the self-consistent fields and the total fields as seen by the particles. These can be accessed through the following properties:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">EMF.Ex</code>, <code class="language-plaintext highlighter-rouge">EMF.Ey</code>, <code class="language-plaintext highlighter-rouge">EMF.Ez</code> - Self-consistent simulation electric fields</li>
  <li><code class="language-plaintext highlighter-rouge">EMF.Bx</code>, <code class="language-plaintext highlighter-rouge">EMF.By</code>, <code class="language-plaintext highlighter-rouge">EMF.Bz</code> - Self-consistent simulation magnetic fields</li>
  <li><code class="language-plaintext highlighter-rouge">EMF.Ex_part</code>, <code class="language-plaintext highlighter-rouge">EMF.Ey_part</code>, <code class="language-plaintext highlighter-rouge">EMF.Ez_part</code> - Total electric field (self-consistent plus external)</li>
  <li><code class="language-plaintext highlighter-rouge">EMF.Bx_part</code>, <code class="language-plaintext highlighter-rouge">EMF.By_part</code>, <code class="language-plaintext highlighter-rouge">EMF.Bz_part</code> - Total magnetic field (self-consistent plus external)</li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 zpic@edu. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
